# encoding: utf-8
require 'git'

task :default => :run
task :run do
	system "jekyll serve --watch --trace"
end

desc 'Initialise the git repository'
task :init do 
	system "git init && git checkout -b source"
	system "git remote add origin https://github.com/liamzebedee/liamz.co.git"
	system "git add -A"
	system "git commit -m \"initial\""
	system "git push --force origin source:source"
	system "git symbolic-ref HEAD refs/heads/gh-pages"
	system "rm .git/index"
	system "git clean -fdx"
	system "touch index.html"
	system "git add index.html"
	system "git commit -m \"Blank new gh-pages branch\""
	system "git push --force origin gh-pages"
	system "git checkout source"
	system "git submodule add -b gh-pages https://github.com/liamzebedee/liamz.co.git _site"
	system "git submodule init"
	system "git submodule update"
	system "cp _site/.git _site.git"
	system "git add _site .gitmodules"
	system "git commit -m \"Added _site as submodule\""
	system "git push origin source"
end

desc 'generate site and push'
task :gen do
	system "jekyll build" or exit!(1)
	system "cp _site.git _site/.git && cd _site && git checkout gh-pages && git add -A && git commit -m \"update site\" && git push origin gh-pages:gh-pages" or exit!(1)
	system "git add -A && git commit -m \"update _site\" && git push origin source:source"
end

# Post-specific
task :post do
	time = Time.new
	postDatename = time.strftime("%Y-%m-%d")
	postFilename = "_posts/#{postDatename}-.md"
	File.open(postFilename, "a") do |file| 
		file.write(<<-eos
---
layout: post
title: 
description: 

category: 
tag: 
---

		eos
		)
	end
end

task :ramble do
	postDatename = Time.new.strftime("%Y-%m-%d")
	postFilename = "_posts/ramblings/#{postDatename}-.md"
	File.open(postFilename, "a") do |file| 
		file.write(<<-eos
---
layout: rambling
category: ramblings
title: 
---

		eos
		)
	end
end
